!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():t.HexagonMap=e()}(this,function(){"use strict";const t={f0:Math.sqrt(3),f1:.5*Math.sqrt(3),f2:0,f3:1.5,b0:Math.sqrt(3)/3,b1:-1/3,b2:0,b3:2/3,angle:30,size:{x:.5*Math.sqrt(3),y:1}},e={f0:1.5,f1:0,f2:.5*Math.sqrt(3),f3:Math.sqrt(3),b0:2/3,b1:0,b2:-1/3,b3:Math.sqrt(3)/3,angle:0,size:{x:1,y:.5*Math.sqrt(3)}},n=[{q:1,r:0},{q:1,r:-1},{q:0,r:-1},{q:-1,r:0},{q:-1,r:1},{q:0,r:1}],i=[{x:1,y:-1,z:0},{x:1,y:0,z:-1},{x:0,y:1,z:-1},{x:-1,y:1,z:0},{x:-1,y:0,z:1},{x:0,y:-1,z:1}];function r(t,e,n){return t+(e-t)*n}function s(t,e){this.q=t,this.r=e}function h(t,e,n){this.x=t,this.y=e,this.z=n}function o(t){return new h(t.q,-t.q-t.r,t.r)}function a(t){return new s(t.x,t.z)}s.prototype={key:function(){return""+this.q+this.r},equals:function(t){return this.q===t.q&&this.r===t.r},add:function(t){return new s(this.q+t.q,this.r+t.r)},substract:function(t){return new s(this.q-t.q,this.r-t.r)},scale:function(t){return new s(this.q*t,this.r*t)},round:function(){return a(o(this).round())},distanceTo:function(t){return o(this).distanceTo(o(t))},lineTo:function(t){let e=o(this).lineTo(o(t));for(let t=0;t<e.length;t++)e[t]=a(e[t]);return e},neighbors:function(){let t=[];for(let e=0;e<n.length;e++)t.push(this.add(n[e]));return t},neighborsInRange:function(t){let e=o(this).neighborsInRange(t);for(let t=0;t<e.length;t++)e[t]=a(e[t]);return e},neighborsInRing:function(t){let e=o(this).neighborsInRing(t);for(let t=0;t<e.length;t++)e[t]=a(e[t]);return e},neighborsInReach:function(t){let e=o(this).neighborsInReach(t);for(let t=0;t<e.length;t++)e[t]=a(e[t]);return e}},h.prototype={key:function(){return""+this.x+this.y+this.z},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},add:function(t){return new h(this.x+t.x,this.y+t.y,this.z+t.z)},substract:function(t){return new h(this.x-t.x,this.y-t.y,this.z-t.z)},scale:function(t){return new h(this.x*t,this.y*t,this.z*t)},round:function(){let t=Math.round(this.x),e=Math.round(this.y),n=Math.round(this.z),i=Math.abs(t-this.x),r=Math.abs(e-this.y),s=Math.abs(n-this.z);return i>r&&i>s?t=-e-n:r>s?e=-t-n:n=-t-e,new h(t,e,n)},distanceTo:function(t){return.5*(Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z))},lineTo:function(t){this.distanceTo(t);let e=[];for(let o=0;o<=N;o++)e.push(h.round((n=this,i=t,s=o/N,new h(r(n.x,i.x,s),r(n.y,i.y,s),r(n.z,i.z,s)))));var n,i,s;return e},neighbors:function(){let t=[];for(let e=0;e<i.length;e++)t.push(this.add(i[e]));return t},neighborsInRange:function(t){let e=[];for(let n=-t;n<=t;n++)for(let i=Math.max(t,-n-t);i<=Math.min(t,-n+t);i++)e.push(new h(n,i,-n-i));return e},neighborsInRing:function(t){if(0==t)return this;let e=[],n=this.add(new h(1,-1,0).scale(t));for(let r=0;r<6;r++)for(let s=0;s<t;s++)e.push(n),n=n.add(i[r]);return e},neighborsInReach:function(t){let e={},n=new Array(t+1);e.push(this),n[0]=[new h(this)];let i=[],r=null,s=!1;for(let h=1;h<=t;h++){n[h]=[];for(let t=0;t<n[h-1].length;t++)for(r of i=n[h-1][t].neighbors())s=!1,!r.key()in e&&!s&&(e[r.key()]=!0,n[h].push(r))}}};var HexagonMap=function(){this.layout=t,this.origin={x:0,y:0},this.size_x,this.size_y,this.hex_width,this.hex_height,this.data={},this.setTileDimensions(20,20)};return HexagonMap.prototype={setLayout:function(n){"flat"===n?this.layout=e:"pointy"===n&&(this.layout=t)},setOrigin:function(t,e){isNaN(parseInt(t))||(this.origin.x=parseInt(t)),isNaN(parseInt(e))||(this.origin.y=parseInt(e))},setTileDimensions:function(t,e){isNaN(parseInt(t))||(this.size_x=parseInt(t),this.hex_width=this.size_x*this.layout.size.x),isNaN(parseInt(e))||(this.size_y=parseInt(e),this.hex_height=this.size_y*this.layout.size.y)},create:function(t,e,n){switch("function"!=typeof n&&(n=function(t){return t}),t){case"parallelogram":this.data=function(t,e){let n=t[0],i=t[1],r=t[2],h=t[3],o={},a=null;for(let t=n;t<=i;t++)for(let n=r;n<=h;n++)a=new s(t,n),o[a.key()]=e(a);return o}(e,n);break;case"diamond":this.data=function(t,e){let n=t[0],i=t[1],r=t[2],h=t[3],o={},a=null;for(let t=n;t<=i;t++)for(let n=r;n<=h;n++)a=new s(t,-t-n),o[a.key()]=e(a);return o}(e,n);break;case"rectangle_odd":this.data=function(t,e){let n=t[0],i=t[1],r={},h=null,o=0,a=Math.floor(.5*n),u=Math.floor(.5*i);for(let t=-u;t<i-u;t++)for(let i=-a-(o=t>>1);i<n-a-o;i++)h=new s(i,t),r[h.key()]=e(h);return r}(e,n);break;case"rectangle_even":this.data=function(t,e){let n=t[0],i=t[1],r={},h=null,o=0,a=Math.floor(.5*n),u=Math.floor(.5*i);for(let t=-u;t<i-u;t++)for(let i=-a-(o=t>>1);i<n-a-o;i++)h=new s(-i-t,t),r[h.key()]=e(h);return r}(e,n);break;case"triangle_top":this.data=function(t,e){let n=t,i={},r=null;for(let t=0;t>=-n;t--)for(let h=-t;h<=n;h++)r=new s(h,t),i[r.key()]=e(r);return i}(e,n);break;case"triangle_down":this.data=function(t,e){let n=t,i={},r=null;for(let t=0;t<=n;t++)for(let h=0;h<=n-t;h++)r=new s(t,h),i[r.key()]=e(r);return i}(e,n);break;case"hexagon":this.data=function(t,e){let n=t,i=0,r=0,h={},o=null;for(let t=-n;t<=n;t++){i=Math.max(-n,-t-n),r=Math.min(n,-t+n);for(let n=i;n<=r;n++)o=new s(t,n),h[o.key()]=e(o)}return h}(e,n)}},getHexagon:function(t,e){let n=this.coordToHex({x:t,y:e}).round().key();return n in this.data?this.data[n]:null},getNeighbors(t){return t?this.filterHexagonList(t.neighbors()):null},getHexagonBetween:function(t,e,n,i){let r=this.coordToHex({x:t,y:e}).round(),s=this.coordToHex({x:n,y:i}).round();return this.filterHexagonList(r.lineTo(s))},filterHexagonList:function(t){let e=[],n="";for(var i=0;i<t.length;i++)(n=t[i].key())in this.data&&e.push(this.data[n]);return e},hexToCoord:function(t){return{x:(this.layout.f0*t.q+this.layout.f1*t.r)*this.size_x,y:(this.layout.f2*t.q+this.layout.f3*t.r)*this.size_y}},coordToHex:function(t){let e=(t.x-this.origin.x)/this.size_x,n=(t.y-this.origin.y)/this.size_y;return new s(this.layout.b0*e+this.layout.b1*n,this.layout.b2*e+this.layout.b3*n)},draw:function(t){let e=Object.keys(this.data);for(let n=0;n<e.length;n++)this.drawHex(t,this.data[e[n]])},drawHex:function(t,e){let n=this.hexToCoord(e),i=this.origin.x+n.x,r=this.origin.y+n.y;if(e.image)t.drawImage(e.image,i-this.hex_width,r-this.hex_height,2*this.hex_width,2*this.hex_height);else{let e=[],n=0,s=0,h=0;for(let t=0;t<6;t++)n=Math.PI*(this.layout.angle+60*t)/180,s=i+this.size_x*Math.cos(n),h=r+this.size_y*Math.sin(n),e.push({x:s,y:h});t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let n=1;n<=6;n++)t.lineTo(e[n%6].x,e[n%6].y);t.stroke()}}},HexagonMap});
